<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>City Data Visualization Dashboard</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
    <h1>City Data Visualization Dashboard</h1>
    <form id="plot-form">
        <label for="city">Choose a city:</label>
        <select id="city" name="city">
            <option value="chicago">Chicago</option>
            <option value="la">Los Angeles</option>
            <option value="ny">New York</option>
            <option value="houston">Houston</option>
            <option value="phoenix">Phoenix</option>
        </select>
        <label for="metric">Choose a metric:</label>
        <select id="metric" name="metric">
            <option value="commute">Commute</option>
            <option value="unemployment">Unemployment</option>
            <option value="income">Income</option>
            <option value="education">Education</option>
            <option value="rent">Rent</option>
            <option value="age">Age</option>
            <option value="race">Race</option>
        </select>
        <button type="submit">Generate Table</button>
    </form>
    <div id="table-container"></div>
    <script>
        // Function to build the table
        function buildTable(city, metric) {
            const filePath = `/data_files/${city}_data/${city}_data.json`;
            d3.json(filePath).then((data) => {
                var result = data[metric];
                var tableContainer = d3.select("#table-container");
                tableContainer.html("");

                var table = tableContainer.append("table").attr("border", 1);
                var thead = table.append("thead");
                var tbody = table.append("tbody");

                // Append the header row
                thead.append("tr")
                    .selectAll("th")
                    .data(Object.keys(result[0]))
                    .enter()
                    .append("th")
                    .text(d => d);

                // Append the data rows
                result.forEach(row => {
                    var tr = tbody.append("tr");
                    Object.values(row).forEach(value => {
                        tr.append("td").text(value);
                    });
                });
            }).catch(error => {
                console.error('Error fetching the JSON data:', error);
            });
        }

        // Function to initialize the dashboard
        function init() {
            const city = document.getElementById('city').value;
            const metric = document.getElementById('metric').value;
            buildTable(city, metric);
        }

        // Function for event listener
        function optionChanged() {
            const city = document.getElementById('city').value;
            const metric = document.getElementById('metric').value;
            buildTable(city, metric);
        }

        // Initialize the dashboard
        init();

        // Event listener for the dropdown menu
        document.getElementById('plot-form').addEventListener('submit', function(event) {
            event.preventDefault();
            optionChanged();
        });

        // Event listeners for the dropdown menus
        document.getElementById('city').addEventListener('change', optionChanged);
        document.getElementById('metric').addEventListener('change', optionChanged);
    </script>
</body>
</html>